# 多态&虚函数&纯虚函数&抽象类

## 多态

所谓多态性，顾名思义就是“多个性态”。更具体一点的就是，用一个名字定义多个函数，这些函数执行不同但相似的工作。

静态多态：**函数重载**和**模板**。

动态多态：**虚函数**。

## 虚函数

含义：在某基类中声明为 virtual，并在一个或多个派生类中被重新定义的成员函数。

```c++
virtual void funtion();
```

目的：**实现多态性**，通过指向派生类的基类指针或引用，访问派生类中同名覆盖成员函数。指向基类的指针（或引用）在操作它的多态类对象时，会根据不同的类对象，调用其相应的函数，这个函数就是虚函数。

- 虚函数是**需要被实现**的，纯虚函数是**不能被实现**的。
- 定义他为虚函数是为了允许用**基类的指针（或引用）**来调用**子类**的这个函数。
- 定义纯虚函数是为了实现一个**接口**，起到一个规范的作用，规范继承这个类的程序员必须实现这个函数。

## 纯虚函数

含义：纯虚函数是在**基类（一般最顶层）**中声明的虚函数，它在基类中没有定义，但要求任何派生类都要定义自己的实现方法。在基类中实现纯虚函数的方法是在函数原型后加“=0”。

```c++
virtual void funtion() = 0;
```

引入原因：为了方便使用多态特性，我们常常需要在基类中定义虚函数。但在很多情况下，基类本身生成对象是不合情理的。例如，动物作为一个基类可以派生出老虎、孔雀等子类，但**动物本身生成对象明显不合常理**。

目的：使派生类仅仅只是**继承函数的接口**。让所有的类对象（主要是派生类对象）都可以执行纯虚函数的动作，但类无法为纯虚函数提供一个合理的缺省实现。**纯虚函数的声明就是在告诉子类的设计者，“你必须提供一个纯虚函数的实现，但我不知道你会怎样实现它”。**

- 含有纯虚拟函数的类称为抽象类，它不能生成对象（类的实例），只能创建它的派生类的实例。
- 编译器要求在派生类中必须予以重写以实现多态性。

## 抽象类

含义：称**带有纯虚函数的类**为抽象类。

作用：抽象类的主要作用是将有关的操作作为结果接口组织在一个继承层次结构中，由它来为**派生类提供一个公共的根**，派生类将具体实现在其基类中作为接口的操作。所以派生类实际上刻画了一组子类的操作接口的通用语义，这些语义也传给子类，子类可以具体实现这些语义，也可以再将这些语义传给自己的子类。

- 抽象类只能作为基类来使用，其纯虚函数的实现由派生类给出。如果派生类中**没有重新定义纯虚函数**，而只是继承基类的纯虚函数，则这个派生类**仍然还是一个抽象类**。如果派生类中给出了基类纯虚函数的实现，则该派生类就不再是抽象类了，它是一个可以建立对象的具体的类。
- 抽象类是**不能定义对象**的。

## 构造函数和析构函数能否为虚函数

**1）构造函数不能声明为虚函数**

- C++对象在三个地方构建：（1）函数堆栈；（2）自由存储区，或称之为堆；（3）静态存储区。无论在那里构建，其过程都是两步：首先，分配一块内存；其次，调用构造函数。好，问题来了，如果构造函数是虚函数，那么就需要通过vtable来调用，但此时面对一块raw memeory，到哪里去找vtable呢？毕竟，**vtable是在构造函数中才初始化**，而不是在其之前。因此构造函数不能为虚函数。
- 构造函数也不需要是虚函数，因为创建一个对象时我们总是要**明确指定对象的类型**，尽管我们可能通过基类的指针或引用去访问它。

**2）析构函数可以声明为虚函数，而且有时是必须声明为虚函数**

- 基类指针可以指向派生类的对象（多态性），如果释放该指针，就会调用该指针指向的派生类析构函数，而派生类的析构函数又自动调用基类的析构函数，这样整个派生类的对象完全被释放。**如果析构函数不被声明成虚函数，则编译器实施静态绑定，在删除基类指针时，只会调用基类的析构函数而不调用派生类析构函数**，这样就会造成**派生类对象析构不完全**。
- 如果某个类不包含虚函数，那一般是表示它将不作为一个基类来使用。**当一个类不准备作为基类使用时，使析构函数为虚一般是个坏主意**。因为它会为类**增加一个虚函数表**，使得对象的体积翻倍，还有可能降低其可移植性。所以基本的一条是：无故的声明虚析构函数和永远不去声明一样是错误的。实际上，很多人这样总结：当且仅当类里包含至少一个虚函数的时候才去声明虚析构函数，即**只有当一个类被用来作为基类的时候，才把析构函数写成虚函数**。

### 参考链接

[C++\] 虚函数和纯虚函数(virtual)_丶布布的博客-CSDN博客_c++ 虚函数和纯虚函数](https://blog.csdn.net/weixin_43197380/article/details/89069724)

[C++ 虚函数和纯虚函数的区别 | 菜鸟教程 (runoob.com)](https://www.runoob.com/w3cnote/cpp-virtual-functions.html)

[(19条消息) 为什么构造函数不能是虚函数？析构函数可以是虚函数吗？_LQB梦烦了的博客-CSDN博客_构造函数为什么不能是虚函数](https://blog.csdn.net/qq_34364654/article/details/107245276?spm=1001.2101.3001.6650.1&depth_1-utm_relevant_index=2)

[(19条消息) 虚函数表详解_吉吉爱马仕的博客-CSDN博客_虚函数表](https://blog.csdn.net/primeprime/article/details/80776625)